!function(){"use strict";
frappe.templates.item_dashboard='<div> <div class="dashboard-list-item">   <div class="row"><div class="col-sm-1 small" style="margin-top: 8px;"><center><input type="checkbox" id="chcb1" name="chcb1" class="chcb1"></center></div><div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;"><b>Vendor</b></div><div class="col-sm-1 small" style="margin-top: 8px;margin-left:-20px;"><b>Inv#</b></div> <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;margin-left:30px;"><b>PO$ </b> </div>  <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;"><b>Inv$</b></div><div class="col-sm-1 small" style="margin-top: 8px;text-align:right;"><b> Budget </b></div><div class="col-sm-1 small" style="margin-top: 8px;">  <b>PO Date</b>  </div><div class="col-sm-1 small" style="margin-top: 8px;"> <b> Invoice Date </b> </div><div class="col-sm-1 small" style="margin-top: 8px;"> <a data-type="match"> <b> Match ? </b></a></div><div class="col-sm-1 small" style="margin-top: 8px;">  <b>Pending With  </b></div><div class="col-sm-1 small" style="margin-top: 8px;"><b>Status</b></div>   </div></div> <div class="result"></div>  <center><div id="records" class="records" style="font-size:90%;color:grey;"></div>  </center> <div id="btn-more" class="more"  style="padding: 15px;"> <a class="btn btn-default btn-xs btn-more">More</a>  </div> </div>  <center><table><tr><td><div class="submit"><button  id="btn-submit" class="btn btn-default btn-xs btn-submit  button-sbt button" style="display:none;margin-top: 20px;">Submit</a>    </div></td><td><div>&nbsp;<button id="btn-approve" class="btn btn-default btn-xs btn-approve button-apr button" style="display:none;">Approve</a>    </div></td><td><div>&nbsp;<button id="btn-reject" class="btn btn-default btn-xs btn-reject button btn-danger" style="display:none;">Reject</a>    </div></td></tr></center>',frappe.templates.item_dashboard_list='<style>input{border: none;background: transparent;}.button-sbt {background-color: #008CBA;}.button-apr {background-color: #4CAF50;}.button {border: none; color: white; padding: 6px 6px;text-align: center;font-size: 10px;margin: 2px 2px;}div.b {word-wrap: break-word;}.hover{cursor: pointer;margin: 15px 0;}</style>{% for d in data %}  <div class="dashboard-list-item">   <div class="row"> <div class="col-sm-1 small" style="margin-top: 8px;"><center>{%if (((d[4]=="Draft")||(d[4]=="Rejected"))&&(d[10]=="1"||d[10]=="3"))%}<input type="checkbox" id="chcb2" name="chcb2" class="btn-check">{%else%}{%if ((d[4]=="Pending")&&(d[10]=="2"||d[10]=="3"))%}<input type="checkbox" id="chcb2" name="chcb2" class="btn-check">{%else%}<input type="checkbox" id="chcb2" name="chcb2" class="btn-check" disabled>{%endif%}{%endif%}</center></div>  <div class="b">  <div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;">     <a data-type="supplier" data-name="{{ d.supplier }}">{{d[1]}}</a>   </div> </div>    <div class="col-sm-1 small" style="margin-top: 8px;margin-left:-20px;">  <div style="color:blue;">       <label value={{d[0]}} style="color:blue;" id="inv" class="inv"> <a data-type="purchase_invoice"       data-name="{{d[0]}}" href="/desk#Form/Purchase%20Invoice/{{d[0]}}"  target="_blank"><font style="color:blue;">{{d[0]}}</font></a></label></div>{%if (d[12]>0)%}<i class="fa fa-paperclip" aria-hidden="true"></i>{%endif%}</div><div class="b"> <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;margin-left:30px;" word-wrap: break-word;>  {{ d[5] }}  </div> </div>  <div class="b">  <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;"> {{ d[2]}} </div>  </div> <div class="b"> <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;">  {{ d[9] }}  </div></div><div class="b"><div class="col-sm-1 small" style="margin-top: 8px;">  {{d[6]}}  </div> </div><div class="b"><div class="col-sm-1 small" style="margin-top: 8px;">  {{ d[3] }}  </div></div><div class="col-sm-1 small" style="margin-top: 8px;">  <a data-type="match">{%if d[7]==1%}Y{%else%}N{%endif%} </a> </div> <div class="b"><div class="col-sm-1 small" style="margin-top: 8px;">  {{ d[8] }}  </div></div><div class="b"><div name="{{d[1]}}" class="col-sm-1" style="margin-top: 8px;text-align:left;"> </a>         {%if (d[4]=="To Pay")%} <button id="btn-status" class="btn btn-default btn-xs btn-add btn-success btn-status" value="{{d[1]}}" >{{d[4]}}</button>{%else%}{%if (d[4]=="Rejected")%} <button id="btn-status" class="btn btn-default btn-xs btn-add btn-danger btn-status" value="{{d[1]}}">{{d[4]}} </button>{%else%}{%if (d[4]=="Draft")%} <button id="btn-status" class="btn btn-default btn-xs btn-info btn-status" value="{{d[1]}}">{{d[4]}}</button>{%else%}<button id="btn-status" class="btn btn-default btn-xs btn-add btn-warning btn-status" value="{{d[1]}}">{{d[4]}}</button> {%endif%} {%endif%} {%endif%}</div></div>    </div>  </div> {% endfor %}',

frappe.provide("seabridge_app"),
seabridge_app.ActionTable=Class.extend({
    init:function(e){
        $.extend(this,e),this.make()
    },
make:function(){
var e=this;
function t(t,a){
}
	this.role=0
	this.start=0,
	this.sort_by||(this.sort_by="purchase_invoice",this.sort_order="desc"),
	this.content=$(frappe.render_template("item_dashboard")).appendTo(this.parent),this.result=this.content.find(".result"),
	this.content.on("click",".btn-move",function(){t($(this),"Move")}),
	this.content.on("click",".btn-add",function(){t($(this),"Add")}),
	this.content.on("click",".btn-submit",function(){
		var allCB = document.querySelectorAll("input[id='chcb2']");
		var allInv = document.querySelectorAll("label[id='inv']");
		
		for(var i=0; i< allInv.length; i++){
			if(allCB[i].checked==true){
				frappe.call({method:"seabridge_app.seabridge_app.api.web_form",
				    async:false,
			    	    args:
			    	    {doc:allInv[i].textContent.trim(),
			    	   },
			    	    callback:function(r){
			    	    }
				})
			}
		    }
		window.location.reload();

	}),
	this.content.on("click",".lab-sts",function(){
		var vendor = jQuery(this).attr('value');
		get_paid_invoices(vendor)
	}),
	this.content.on("click",".btn-status",function(){
		var vendor = jQuery(this).attr('value');
		get_paid_invoices(vendor)
	}),
	this.content.on("click",".btn-approve",function(){
		var allCB = document.querySelectorAll("input[id='chcb2']");
		var allInv = document.querySelectorAll("label[id='inv']");
		for(var i=0; i< allInv.length; i++){
			if(allCB[i].checked==true){
				frappe.call({method:"seabridge_app.seabridge_app.api.approve_invoice",
				    async:false,
			    	    args:
			    	    {doc:allInv[i].textContent.trim(),
			    	   },
			    	    callback:function(r){
			    	    }
				})
			}
			
		    }
		window.location.reload();

	}),
	this.content.on("click",".btn-reject",function(){
		var i=new frappe.ui.Dialog({title:__("To continue with rejection select the reason"),
	                    fields:[{fieldname:"remarks",label:__("Remarks"),fieldtype:"Link",options:"Rejection Reason",reqd:1}
	                   ]});
		i.show();
		i.set_primary_action(__("Reject"),
		function(){
			var allCB = document.querySelectorAll("input[id='chcb2']");
			var allInv = document.querySelectorAll("label[id='inv']");
			reject_invoices(i.get_value("remarks"),allCB,allInv)
		})

	}),
	this.content.on("click",".btn-check",function(){
		var checked_val=0
		var allCB = document.querySelectorAll("input[id='chcb2']");
		for(var i=0; i< allCB.length; i++){
			if(allCB[i].checked==true){checked_val++}
		}
		if(checked_val==0){
			document.getElementById("btn-reject").style.display="none";
			document.getElementById("btn-approve").style.display="none";
			document.getElementById("btn-submit").style.display="none";
		
		}
		else
		{
			frappe.call({method:"seabridge_app.seabridge_app.api.get_user_roles_dashboard",
				    	    callback:function(r){
				    	  	this.role=r.message
						if(r.message==3 || r.message==1){
							document.getElementById("btn-submit").style.display="block";
				    	    	}
						if(r.message==3 || r.message==2){
							document.getElementById("btn-reject").style.display="block";
							document.getElementById("btn-approve").style.display="block";
						}
					}
			})
		}
	}),

	this.content.on("click",".chcb1",function(){
		if(chcb1.checked==1){
			var role=0
			var allCB = document.querySelectorAll("input[id='chcb2']");
			var allBut = document.querySelectorAll("button[id='btn-status']");
			frappe.call({method:"seabridge_app.seabridge_app.api.get_user_roles_dashboard",
				    async:false,
			    	    callback:function(r){
			    	  	this.role=r.message
					role=r.message
					
				}
			})
			var checked_count=0
			for(var i=0; i< allCB.length; i++){
				if(role==1){
				if((allBut[i].textContent=="Draft") || (allBut[i].textContent.trim()=="Rejected")){
					allCB[i].checked=true
				}}
				else if(role==2){
				if(allBut[i].textContent=="Pending"){
					allCB[i].checked=true
				}}
				if(allCB[i].checked==true){checked_count++}
			}
			if(checked_count>0){
				if(role==1){
					document.getElementById("btn-submit").style.display="block";
			    	}
				if(role==2){
					document.getElementById("btn-reject").style.display="block";
					document.getElementById("btn-approve").style.display="block";
				}

			}
		}
		else{
			var allCB = document.querySelectorAll("input[id='chcb2']");
			for(var i=0; i< allCB.length; i++){
				allCB[i].checked=false
			}
			document.getElementById("btn-reject").style.display="none";
			document.getElementById("btn-approve").style.display="none";
			document.getElementById("btn-submit").style.display="none";
		}
	}),
	
	this.content.find(".btn-more").on("click",function(){
	    e.start+=20,e.refresh()
	})
},
	refresh:function(){
	    this.before_refresh&&this.before_refresh();
	    var e=this;
	    var accounts_payable=0
	    frappe.call({method:"seabridge_app.seabridge_app.api.get_user_roles_dashboard",
				async:false,
				callback:function(r){
					if(r.message==2){
						accounts_payable=1
					}
				}
	    })
		if(accounts_payable==1){
			    frappe.call({method:"seabridge_app.seabridge_app.api.get_data",
		    	    args:
		    	    {name:this.purchase_invoice,
		    	    supplier:this.supplier,
		    	    match:this.match,
			    status:this.status,
			    company:this.company,
		    	    start:this.start,
		    	    sort_by:this.sort_by,
		    	    sort_order:this.sort_order},
		    	    callback:function(t){
		    	        e.render(t.message)
				if(t.message.length>0){
						if(parseInt(e.start+20)>parseInt(t.message[0][11])){
							document.getElementById("records").innerHTML = "Showing "+t.message[0][11]+" of "+t.message[0][11]+" records";
							document.getElementById("btn-more").style.display="none";
						}
						else{
							document.getElementById("records").innerHTML = "Showing "+(e.start+20)+" of "+t.message[0][11]+" records";
							document.getElementById("btn-more").style.display="block";
						}
					}
					else{
						document.getElementById("btn-more").style.display="none";
						document.getElementById("records").innerHTML = "Showing 0 of 0 records";
					}
		    	    }
			    })
			
		}
		else{
			frappe.call({method:"seabridge_app.seabridge_app.api.get_data",
		    	    args:
		    	    {name:this.purchase_invoice,
		    	    supplier:this.supplier,
		    	    match:this.match,
			    status:this.status,
			    company:'',
		    	    start:this.start,
		    	    sort_by:this.sort_by,
		    	    sort_order:this.sort_order},
		    	    callback:function(t){
		    	        e.render(t.message)
				if(t.message.length>0){
						if(parseInt(e.start+20)>parseInt(t.message[0][11])){
							document.getElementById("records").innerHTML = "Showing "+t.message[0][11]+" of "+t.message[0][11]+" records";
							document.getElementById("btn-more").style.display="none";
						}
						else{
							document.getElementById("records").innerHTML = "Showing "+(e.start+20)+" of "+t.message[0][11]+" records";
							document.getElementById("btn-more").style.display="block";
						}
					}
					else{
						document.getElementById("btn-more").style.display="none";
						document.getElementById("records").innerHTML = "Showing 0 of 0 records";
					}
		    	    }
			    })
		}
	},
	render:function(e){
	    0===this.start&&(this.max_count=0,this.result.empty());
	    var t=this.get_item_dashboard_data(e,this.max_count,!0);
	    if(this.max_count=this.max_count,e&&21===e.length?(this.content.find(".more").removeClass("hidden"),e.splice(-1)):1,t.data.length>0)
	    $(frappe.render_template("item_dashboard_list",t)).appendTo(this.result);
	    else{
	        var a=__("No further records available");
	        $("<span class='text-muted small'>  "+a+" </span>").appendTo(this.result)}},

	        get_item_dashboard_data:function(e,t,a){
	            t||(t=0),e||(e=[])
	            var r=0;
	            return frappe.boot.user.can_write.indexOf("Purchase Invoice")>=0&&(r=1),{
	                data:e,max_count:t,can_write:r,show_item:a||!1}
	            
	        }
	})
}();

function reject_invoices(reason,allCB,allInv){
	for(var i=0; i< allInv.length; i++){
			if(allCB[i].checked==true){
				frappe.call({method:"seabridge_app.seabridge_app.api.reject_invoice",
				    async:false,
			    	    args:
			    	    {doc:allInv[i].textContent.trim(),
				    remarks:reason
			    	   },
			    	    callback:function(r){
			    	       
			    	    }
				})
			}
			
		    }
	window.location.reload();


}

function get_paid_invoices(supplier){	
	selections=""
		 let dialogObj= new frappe.ui.form.MultiSelectDialog({
			 doctype: "Purchase Invoice",
			 target: this,
			 setters: {
			 grand_total:"",
			 due_date:"",
			 paid_date:""
			 },
			 date_field: "transaction_date",
			 get_query() {
			 return {
				 filters: {  docstatus: ['=', 1],supplier: ['=', supplier],status: ['=', 'Paid']}
				 }
			 },
			 action(selections) {
			}
	})
}

//# sourceMappingURL=item-dashboard.min.js.map
