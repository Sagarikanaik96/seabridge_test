!function(){"use strict";
frappe.templates.mcst_dashboard='<div> <div class="dashboard-list-item">   <div class="row"><div class="col-sm-1 small" style="margin-top: 8px;"><center><input type="checkbox" id="chcb1" name="chcb1" class="chcb1"></center></div><div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;"><b>BPA Number</b></div><div class="col-sm-1 small" style="margin-top: 8px;margin-left:-20px;"><b>Mode of Payment</b></div><div class="col-sm-1 small" style="margin-top: 8px;"><b>Date</b></div> <div class="col-sm-2 small" style="margin-top: 8px;text-align:right;"><b>Total Accepted Invoices</b></div><div class="col-sm-2 small" style="margin-top: 8px;text-align:right;"><b>Total Approvals Required</b></div><div class="col-sm-2 small" style="margin-top: 8px;text-align:right;"><b>Total Current Approvers</b></div><div class="col-sm-1 small" style="margin-top: 8px;text-align:left;margin-left:20px;"><b> Status </b></div> </div></div><div class="result"></div>  <div id="btn-more" class="more"  style="padding: 15px;"> <a class="btn btn-default btn-xs btn-more">More</a>  </div> </div>  <center><div id="records" class="records" style="font-size:90%;color:grey;"></div> <center><table><tr><td><div class="submit"><button id="btn-approve" class="btn btn-default btn-xs btn-pay  btn-approve button"  style="display:none;background-color:#4CAF50;width: 160px;font-size: 12px;">Approve</a>    </div></td></tr></center>',frappe.templates.item_dashboard_list='<style>input{border: none;background: transparent;}.button-sbt {background-color: #008CBA;}.button-apr {background-color: #4CAF50;}.button {border: none; color: white; padding: 6px 6px;text-align: center;font-size: 10px;margin: 2px 2px;}div.b {word-wrap: break-word;}.hover{cursor: pointer;margin: 15px 0;}</style>{% for d in data %}  <div class="dashboard-list-item">   <div class="row"> <div class="col-sm-1 small" style="margin-top: 8px;"><center>{%if d[4]=="Pending"%}<input type="checkbox" id="chcb2" name="chcb2" class="btn-check">{%else%}<input type="checkbox" id="chcb2" name="chcb2" class="btn-check" disabled>{%endif%}</center></div>  <div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;word-wrap: break-word;" id="bpa">     <a data-type="bpa" data-name="{{ d[0] }}" href="/desk#Form/Bank%20Payment%20Advice/{{d[0]}}" target="_blank"><font style="color:blue;" class="hover"><b>{{d[0]}}</b></font></a>   </div>  <div class="col-sm-1 small" style="margin-top: 8px;margin-left:-20px;">{{ d[7]}}</div> <div class="col-sm-1 small" style="margin-top: 8px;word-wrap: break-word;"> {{ d[1]}} </div>  <div class="col-sm-2 small" style="margin-top: 8px;text-align:right;">{{ d[8]}}</div><div class="col-sm-2 small" style="margin-top: 8px;text-align:right;word-wrap: break-word;"> {{ d[3]}} </div><div class="col-sm-2 small" style="margin-top: 8px;text-align:right;word-wrap: break-word;"> {{ d[6]}} </div><div class="col-sm-1 small" style="margin-top: 8px;word-wrap: break-word;margin-left:20px;"> {%if (d[4]=="Pending")%} <button id="btn-status" class="btn btn-default btn-xs btn-info btn-status" value="{{d[1]}}" style="background-color:#FFA00A;">{{d[4]}}</button>{%else%}<button id="btn-status" class="btn btn-default btn-xs btn-add btn-success btn-status" style="white-space: normal;" value="{{d[1]}}" style="background-color:#4CAF50;">{{d[4]}}</button> {%endif%}</div></div></div>{% endfor %}',

frappe.provide("seabridge_app"),
seabridge_app.ActionTable=Class.extend({
    init:function(e){
        $.extend(this,e),this.make()
    },
make:function(){
var e=this;
function t(t,a){
}
	this.role=0
	this.start=0,
	this.sort_by||(this.sort_by="name",this.sort_order="desc"),
	this.content=$(frappe.render_template("mcst_dashboard")).appendTo(this.parent),this.result=this.content.find(".result"),
	this.content.on("click",".btn-move",function(){t($(this),"Move")}),
	this.content.on("click",".btn-add",function(){t($(this),"Add")}),
	
	this.content.find(".btn-more").on("click",function(){
	    e.start+=20,e.refresh()
	}),
	this.content.on("click",".btn-check",function(){
		var checked_val=0
		var allCB = document.querySelectorAll("input[id='chcb2']");
		
		for(var i=0; i< allCB.length; i++){
			if(allCB[i].checked==true){checked_val++}
		}
		if(checked_val>0){document.getElementById("btn-approve").style.display="block";}
		else{document.getElementById("btn-approve").style.display="none";}
		
	}),
	
	this.content.on("click",".chcb1",function(){
		var allCB = document.querySelectorAll("input[id='chcb2']");
		var allBtn = document.querySelectorAll("button[id='btn-status']");
		if(chcb1.checked==1){
			for(var i=0; i< allCB.length; i++){
				if(allBtn[i].textContent.trim()=="Pending"){
					allCB[i].checked=true
				}
			}
			document.getElementById("btn-approve").style.display="block";
		}
		else{
			for(var i=0; i< allCB.length; i++){
				allCB[i].checked=false
				document.getElementById("btn-approve").style.display="none";
			}
		}
	})
	this.content.on("click",".btn-approve",function(){
		const bpas=[]
		var allCB = document.querySelectorAll("input[id='chcb2']");
		var allBPA = document.querySelectorAll("div[id='bpa']");
		for(var i=0; i< allBPA.length; i++){
			if(allCB[i].checked==true){
				frappe.call({method:"seabridge_app.seabridge_app.api.approve_bpa",
				    async:false,
			    	    args:
			    	    {doc:allBPA[i].textContent.trim(),
			    	   },
			    	    callback:function(r){
					if(r.message==false){bpas.push(allBPA[i].textContent.trim())}

			    	    }
				})
			}
			
		    }
		if(bpas.length>0){alert("You don't have permission to approve the documents  "+bpas+" as you have already approved the documents once.");}
		else{window.location.reload();
		}


	})
},
	
	refresh:function(){
	    this.before_refresh&&this.before_refresh();
	    var e=this;
			    frappe.call({method:"seabridge_app.seabridge_app.api.get_bpa_data",
		    	    args:
		    	    {name:this.bpa,
			    status:this.status,
			    company:this.company,
		    	    start:this.start,
		    	    sort_by:this.sort_by,
		    	    sort_order:this.sort_order},
		    	    callback:function(t){
		    	        e.render(t.message)
				if(t.message.length>0){
						if(parseInt(e.start+20)>parseInt(t.message[0][5])){
							document.getElementById("records").innerHTML = "Showing "+t.message[0][5]+" of "+t.message[0][5]+" records";
							document.getElementById("btn-more").style.display="none";
						}
						else{
							document.getElementById("records").innerHTML = "Showing "+(e.start+20)+" of "+t.message[0][5]+" records";
							document.getElementById("btn-more").style.display="block";
						}
					}
					else{
						document.getElementById("btn-more").style.display="none";
						document.getElementById("records").innerHTML = "Showing 0 of 0 records";
					}
		    	    }
			    })
		
		
	},
	render:function(e){
	    0===this.start&&(this.max_count=0,this.result.empty());
	    var t=this.get_item_dashboard_data(e,this.max_count,!0);
	    if(this.max_count=this.max_count,e&&21===e.length?(this.content.find(".more").removeClass("hidden"),e.splice(-1)):1,t.data.length>0)
	    $(frappe.render_template("item_dashboard_list",t)).appendTo(this.result);
	    else{
	        var a=__("No further records available");
	        $("<span class='text-muted small'>  "+a+" </span>").appendTo(this.result)}},

	        get_item_dashboard_data:function(e,t,a){
	            t||(t=0),e||(e=[])
	            var r=0;
	            return frappe.boot.user.can_write.indexOf("Purchase Invoice")>=0&&(r=1),{
	                data:e,max_count:t,can_write:r,show_item:a||!1}
	            
	        }
	})
}();

function reject_invoices(reason,allCB,allInv){
	for(var i=0; i< allInv.length; i++){
			if(allCB[i].checked==true){
				frappe.call({method:"seabridge_app.seabridge_app.api.reject_invoice",
				    async:false,
			    	    args:
			    	    {doc:allInv[i].textContent.trim(),
				    remarks:reason
			    	   },
			    	    callback:function(r){
			    	       
			    	    }
				})
			}
			
		    }
	window.location.reload();


}

function get_paid_invoices(supplier){	
	selections=""
		 let dialogObj= new frappe.ui.form.MultiSelectDialog({
			 doctype: "Purchase Invoice",
			 target: this,
			 setters: {
			 grand_total:"",
			 due_date:"",
			 paid_date:""
			 },
			 date_field: "transaction_date",
			 get_query() {
			 return {
				 filters: {  docstatus: ['=', 1],supplier: ['=', supplier],status: ['=', 'Paid']}
				 }
			 },
			 action(selections) {
			}
	})
}

//# sourceMappingURL=item-dashboard.min.js.map
