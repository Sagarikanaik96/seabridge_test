!function(){"use strict";
frappe.templates.item_dashboard='<div> <div class="dashboard-list-item">   <div class="row"><div class="col-sm-1 small" style="margin-top: 8px;"><center><input type="checkbox" id="chcb1" name="chcb1" class="chcb1"></center></div><div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;"><b>Vendor</b></div><div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;"><b>Inv#</b></div>   <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;"><b>Inv$</b></div><div class="col-sm-1 small" style="margin-top: 8px;text-align:right;"><b> Budget </b></div><div class="col-sm-1 small" style="margin-top: 8px;">  <b>PO Date</b>  </div><div class="col-sm-1 small" style="margin-top: 8px;"> <b> Invoice Due Date </b> </div><div class="col-sm-1 small" style="margin-top: 8px;"> <a data-type="match"> <b> Match ? </b></a></div><div class="col-sm-1 small" style="margin-top: 8px;">  <b>Pending With  </b></div><div class="col-sm-1 small" style="margin-top: 8px;"><b>Status</b></div>   </div></div> <div class="result"></div>  <div id="btn-more" class="more"  style="padding: 15px;"> <a class="btn btn-default btn-xs btn-more">More</a>  </div> </div>  <center><div id="records" class="records" style="font-size:90%;color:grey;"></div> <center><table><tr><td><div class="submit"><button id="btn-pay" class="btn btn-default btn-xs btn-pay  button-sbt button"  style="display:none;">Create Payment</a>    </div></td></tr></center>',frappe.templates.item_dashboard_list='<style>input{border: none;background: transparent;}.button-sbt {background-color: #008CBA;}.button-apr {background-color: #4CAF50;}.button {border: none; color: white; padding: 6px 6px;text-align: center;font-size: 10px;margin: 2px 2px;}div.b {word-wrap: break-word;}.hover{cursor: pointer;margin: 15px 0;}</style>{% for d in data %}  <div class="dashboard-list-item">   <div class="row"> <div class="col-sm-1 small" style="margin-top: 8px;"><center><input type="checkbox" id="chcb2" name="chcb2" class="btn-check"></center></div>  <div class="b">  <div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;">     <a data-type="supplier" data-name="{{ d.supplier }}">{{ d[1] }}</a>   </div> </div>    <div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;">  <div style="color:blue;">        <label value="{{d[0]}}" style="color:blue;" id="inv" class="inv"><font style="color:blue;" class="hover">{{d[0]}}</font></label>&nbsp;{%if (d[12]>0)%}<i class="fa fa-paperclip" aria-hidden="true"></i>{%endif%}</div></div>  <div class="b">  <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;"> {{ d[2]}} </div>  </div> <div class="b"> <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;">  {{ d[9] }}  </div></div><div class="b"><div class="col-sm-1 small" style="margin-top: 8px;">  {{d[6]}}  </div> </div><div class="b"><div class="col-sm-1 small" style="margin-top: 8px;">  {{ d[3] }}  </div></div><div class="col-sm-1 small" style="margin-top: 8px;">  <a data-type="match">{%if d[7]==1%}Y{%else%}N{%endif%} </a> </div> <div class="b"><div class="col-sm-1 small" style="margin-top: 8px;">  {{ d[8] }}  </div></div><div class="b"><div id="btn-status" class="col-sm-1" style="margin-top: 8px;text-align:left;" name="{{d[1]}}" data-type="{{d[1]}}"> </a>         {%if (d[4]=="To Pay")%} <button  class="btn btn-default btn-xs btn-add btn-success btn-status" value="{{d[1]}}">{{d[4]}} </button>{%else%}{%if (d[4]=="Rejected")%} <button  class="btn btn-default btn-xs btn-add btn-danger" onclick="try_function()">{{d[4]}} </button>{%else%}{%if (d[4]=="Draft")%} <button  class="btn btn-default btn-xs btn-info btn-status" onclick="try_function()">{{d[4]}} </button>{%else%}<button  class="btn btn-default btn-xs btn-add btn-warning"  onclick="try_function()">{{d[4]}}</button> {%endif%} {%endif%} {%endif%}</div></div> </div><div class="row"><div class="col-sm-3 small"></div><div class="col-sm-9 small" style="margin-left:-40px;">{{d[13]}} </div></div> </div> {% endfor %}',
frappe.provide("seabridge_app"),
seabridge_app.ActionTable=Class.extend({
    init:function(e){
        $.extend(this,e),this.make()
    },
make:function(){
var e=this;
function t(t,a){
}
	this.start=0,
	this.sort_by||(this.sort_by="invoice_date",this.sort_order="desc"),
	this.content=$(frappe.render_template("item_dashboard")).appendTo(this.parent),this.result=this.content.find(".result"),
	this.content.on("click",".btn-move",function(){t($(this),"Move")}),
	this.content.on("click",".btn-add",function(){t($(this),"Add")}),
	this.content.on("click",".btn-pay",function(){
		var allCB = document.querySelectorAll("input[id='chcb2']");
		var allInv = document.querySelectorAll("label[id='inv']");
		var count=0;
		for(var i=0; i< allInv.length; i++){
			if(allCB[i].checked==true){
				count++;
			}
		}
		var invoices = new Array(count);
		var j=0;
		for(var i=0; i< allInv.length; i++){
			if(allCB[i].checked==true){
				invoices[j]=allInv[i].textContent.trim();
				j++;
			}
			
		    }
		frappe.call({method:"seabridge_app.seabridge_app.api.create_payment",
			    	    args:
			    	    {invoices:invoices,
				     account:e.account,
				     company:e.company
			    	   },
			    	    callback:function(r){
			    	       
			    	    }
				})
		
		//window.location.reload();

	}),	
	this.content.on("click",".inv",function(){
		var invoice = jQuery(this).attr('value');
		frappe.call({method:"seabridge_app.seabridge_app.api.get_invoice_details",
			async:false,
			args:
			{invoice_name:invoice,
			},
			callback:function(r){
				var mockup_window=new frappe.ui.Dialog({title:__('<a href="desk#Form/Purchase%20Invoice/'+invoice+'" style="text-color:blue;" target="_blank"><div style="color:blue;">'+invoice+'</div></a>'),
					fields:[{fieldname:"company",label:__("Company"),fieldtype:"HTML",read_only:1},
						{fieldname:"description",label:__("Invoice Description"),fieldtype:"HTML",read_only:1},
						{fieldname:"po_date",label:__("PO Date"),fieldtype:"HTML",read_only:1},
						{fieldname:"due_date",label:__("Invoice Date"),fieldtype:"HTML",read_only:1},
						{fieldname:"budget",label:__("Budget"),fieldtype:"HTML",read_only:1},
						{fieldname:"column_break",fieldtype:"Column Break"},
						{fieldname:"supplier",label:__("Vendor"),fieldtype:"HTML",read_only:1},
						{fieldname:"po_document",label:__("PO Document"),fieldtype:"HTML",read_only:1},
						{fieldname:"po_amount",label:__("PO$"),fieldtype:"HTML",read_only:1},
						{fieldname:"invoice_amount",label:__("Inv$"),fieldtype:"HTML",read_only:1},
						{fieldname:"net_amount",label:__("Net Amount"),fieldtype:"HTML",read_only:1},
						{fieldname:"tax_amount",label:__("Tax Amount"),fieldtype:"HTML",read_only:1},
						{fieldname:"section_break",fieldtype:"Section Break"},
						{fieldname:"items",label:__("Items"),fieldtype:"HTML",read_only:1},
						{fieldname:"section_break",fieldtype:"Section Break"},
						{fieldname:"checklist",label:__("Attachment Checklist"),fieldtype:"HTML",read_only:1},
						{fieldname:"section_break",fieldtype:"Section Break"},
						{fieldname:"attachments",label:__("Attachments"),fieldtype:"HTML",read_only:1}
					]
				});
				mockup_window.show();
				var attachments=''
				for(var attachment=0; attachment<r.message[1].length; attachment++){
					attachments+='<a href="'+r.message[1][attachment][1]+'" Download><font style="color:blue;font-size: 12px;">'+r.message[1][attachment][0]+'</font></a><br>'
				}
				var po_doc='<font style="font-size: 12px;color:#9E9E9E;">PO Document</font><br><label style="background-color: #EDF2F2; color: blue;width: 260px;height: 29px;"><div style="color: blue;padding-top: 5px;padding-bottom:5px;padding-left: 9px;"></div></label>'
				if(r.message[0][0][4]){
				po_doc='<font style="font-size: 11px;color:#9E9E9E;">PO Document</font><br><label style="background-color: #EDF2F2; color: blue;width: 260px;"><a href="desk#Form/Purchase%20Order/'+r.message[0][0][4]+'" target="_blank"><div style="color: blue;padding-top: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][4]+'</div></a></label>'
				}
				var po_date='<font style="font-size: 12px;color:#9E9E9E;">PO Date</font><br><label style="background-color: #EDF2F2;width: 260px;height: 29px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;"></div></label>'
				if(r.message[0][0][6]){
				po_date='<font style="font-size: 11px;color:#9E9E9E;">PO Date</font><br><label style="background-color: #EDF2F2;width: 260px;height: 29px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][6]+'</div></label>'
				}
				var po_amount='<font style="font-size: 12px;color:#9E9E9E;">PO$</font><br><label style="background-color: #EDF2F2;width: 260px;height: 29px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;"></div></label>'
				if(r.message[0][0][5]){
				po_amount='<font style="font-size: 11px;color:#9E9E9E;">PO$</font><br><label style="background-color: #EDF2F2; width: 260px;height: 29px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][5]+'</div></label>'
				}
				var company='<font style="font-size: 12px;color:#9E9E9E;">Company</font><br><label style="background-color: #EDF2F2; width: 260px;font-size: 16px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][0]+'</div></label>'
				var vendor='<font style="font-size: 12px;color:#9E9E9E;">Vendor</font><br><label style="background-color: #EDF2F2; width: 260px;font-size: 12px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][1]+'</div></label>'
				var description='<font style="font-size: 12px;color:#9E9E9E;">Invoice Description</font><br><label style="background-color: #EDF2F2; width: 260px;height: 29px;font-size: 16px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;"></div></label>'
				if(r.message[0][0][8]){
					description='<font style="font-size: 12px;color:#9E9E9E;">Invoice Description</font><br><label style="background-color: #EDF2F2; width: 260px;font-size: 16px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][8]+'</div></label>'
				}
				var invoice_amount='<font style="font-size: 12px;color:#9E9E9E;">Inv$</font><br><label style="background-color: #EDF2F2; width: 260px;font-size: 16px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][3]+'</div></label>'
				var invoice_date='<font style="font-size: 12px;color:#9E9E9E;">Invoice Due Date</font><br><label style="background-color: #EDF2F2; width: 260px;font-size: 16px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][2]+'</div></label>'
				var budget='<font style="font-size: 12px;color:#9E9E9E;">Budget</font><br><label style="background-color: #EDF2F2; width: 260px;height: 29px;font-size: 16px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;"></div></label>'
				if(r.message[0][0][7]){
					budget='<font style="font-size: 12px;color:#9E9E9E;">Budget</font><br><label style="background-color: #EDF2F2; width: 260px;height: 29px;font-size: 16px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][7]+'</div></label>'
				}
				var items=''
				for(var item=0; item<r.message[0].length; item++){
					items+='<tr><td style="padding-left: 5px;font-size: 12px;">'+r.message[0][item][9]+'</td><td style="padding-right: 5px;text-align:right;font-size: 12px;">'+r.message[0][item][10]+'</td><td style="padding-right: 5px;text-align:right;font-size: 12px;">'+r.message[0][item][11]+'</td><td style="padding-right: 5px;text-align:right;font-size: 12px;">'+r.message[0][item][12]+'</td></tr>'			
				}
				var checklist=''
				for(var item=0; item<r.message[2].length; item++){
					checklist+='<tr><td style="padding-left: 5px;font-size: 12px;">'+r.message[2][item][0]+'</td><td style="padding-left: 5px;font-size: 12px;">'+r.message[2][item][1]+'</td><td style="padding-left: 5px;font-size: 12px;">'+r.message[2][item][2]+'</td></tr>'			
				}
				var net_amount='<font style="font-size: 12px;color:#9E9E9E;">Net Amount</font><br><label style="background-color: #EDF2F2; width: 260px;font-size: 16px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][13]+'</div></label>'
				var tax_amount='<font style="font-size: 12px;color:#9E9E9E;">Tax Amount</font><br><label style="background-color: #EDF2F2; width: 260px;font-size: 16px;"><div style="padding-top: 5px;padding-bottom: 5px;padding-left: 9px;font-size: 12px;">'+r.message[0][0][14]+'</div></label>'
				mockup_window.get_field("company").set_value(company)
				mockup_window.get_field("po_document").set_value(po_doc)
				mockup_window.get_field("po_amount").set_value(po_amount)
				mockup_window.get_field("due_date").set_value(invoice_date)
				mockup_window.get_field("supplier").set_value(vendor)
				mockup_window.get_field("po_date").set_value(po_date)
				mockup_window.get_field("invoice_amount").set_value(invoice_amount)	
				mockup_window.get_field("budget").set_value(budget)	
				mockup_window.get_field("description").set_value(description)
				mockup_window.get_field("net_amount").set_value(net_amount)
				mockup_window.get_field("tax_amount").set_value(tax_amount)
				mockup_window.get_field("items").set_value('<font style="font-size: 11px;color:#9E9E9E;">ITEM DETAILS</font><br><br><table width="100%" border="1" bordercolor="#BCB9B9"><tr bgcolor="#EDF2F2"><th style="padding-left: 5px;font-size: 12px;">Item</th><th style="padding-left: 5px;font-size: 12px;">Quantity</th><th style="padding-left: 5px;font-size: 12px;">Rate</th><th style="padding-left: 5px;font-size: 12px;">Amount</th></tr>'+items+'</table>')
				
				if(r.message[1]!=0){
					mockup_window.get_field("attachments").set_value('<font style="font-size: 11px;color:#9E9E9E;">ATTACHMENTS</font><br><br>'+attachments)
				}
				if(r.message[2]!=0){
					mockup_window.get_field("checklist").set_value('<font style="font-size: 11px;color:#9E9E9E;">ATTACHMENT CHECKLIST</font><br><br><table width="100%" border="1" bordercolor="#BCB9B9"><tr bgcolor="#EDF2F2"><th style="padding-left: 5px;font-size: 12px;">Description</th><th style="padding-left: 5px;font-size: 12px;">Mandatory</th><th style="padding-left: 5px;font-size: 12px;">Remarks</th></tr>'+checklist+'</table>')
				}
	   		}
		})
		
	}),
	this.content.on("click",".btn-status",function(){
		var vendor = jQuery(this).attr('value');
		get_paid_invoices(vendor)
	}),
	this.content.on("click",".btn-check",function(){
		var allCB = document.querySelectorAll("input[id='chcb2']");
		var checked_val=0
		for(var i=0; i< allCB.length; i++){
				if(allCB[i].checked==true){
				checked_val++;
				}
			}
		if(checked_val==0){
			document.getElementById("btn-pay").style.display="none";
		}
		else
		{
			document.getElementById("btn-pay").style.display="block";
		}
	}),

	this.content.on("click",".chcb1",function(){
		var selected_count=0
		if(chcb1.checked==1){
			var allCB = document.querySelectorAll("input[id='chcb2']");
			for(var i=0; i< allCB.length; i++){
				allCB[i].checked=true
				selected_count++;
			}
		}
		else{
			var allCB = document.querySelectorAll("input[id='chcb2']");
			for(var i=0; i< allCB.length; i++){
				allCB[i].checked=false
			}
		}
		if(selected_count>0){document.getElementById("btn-pay").style.display="block";}
	}),
	
	this.content.find(".btn-more").on("click",function(){
	    e.start+=20,e.refresh()
	
	    
	})
},
	refresh:function(){
	    this.before_refresh&&this.before_refresh();
	    var e=this;
	if(this.company!=""){
	    frappe.call({method:"seabridge_app.seabridge_app.api.get_data_for_payment",
	    	    args:
	    	    {
		    name:this.purchase_invoice,
	    	    supplier:this.supplier,
		    company:this.company,
	    	    start:this.start,
	    	    sort_by:this.sort_by,
	    	    sort_order:this.sort_order},
	    	    callback:function(t){
	    	        e.render(t.message)	
			if(t.message.length>0){
				if(parseInt(e.start+20)>parseInt(t.message[0][11])){
					document.getElementById("records").innerHTML = "Showing "+t.message[0][11]+" of "+t.message[0][11]+" records";
					document.getElementById("btn-more").style.display="none";
				}
				else{
					document.getElementById("records").innerHTML = "Showing "+(e.start+20)+" of "+t.message[0][11]+" records";
					document.getElementById("btn-more").style.display="block";
				}
			}
			else{
				document.getElementById("btn-more").style.display="none";
				document.getElementById("records").innerHTML = "Showing 0 of 0 records";
			}	
	    	    }
	    })
		}
	},
	render:function(e){
	    0===this.start&&(this.max_count=0,this.result.empty());
	    var t=this.get_item_dashboard_data(e,this.max_count,!0);
	    if(this.max_count=this.max_count,e&&21===e.length?(this.content.find(".more").removeClass("hidden"),e.splice(-1)):1,t.data.length>0)
	    $(frappe.render_template("item_dashboard_list",t)).appendTo(this.result);
	    else{
	        var a=__("No further records available");
	        $("<span class='text-muted small'>  "+a+" </span>").appendTo(this.result)}},
	        get_item_dashboard_data:function(e,t,a){
	            t||(t=0),e||(e=[]),
	            e.forEach(function(e){
	                e.actual_or_pending=e.projected_qty+e.reserved_qty+e.reserved_qty_for_production+e.reserved_qty_for_sub_contract,
	                e.pending_qty=0,
	                e.total_reserved=e.reserved_qty+e.reserved_qty_for_production+e.reserved_qty_for_sub_contract,
	                e.actual_or_pending>e.actual_qty&&(e.pending_qty=e.actual_or_pending-e.actual_qty),
	                t=Math.max(e.actual_or_pending,e.actual_qty,e.total_reserved,t)
	                
	            });
	            var r=0;
	            return frappe.boot.user.can_write.indexOf("Stock Entry")>=0&&(r=1),{
	                data:e,max_count:t,can_write:r,show_item:a||!1}
	            
	        }
}),
	                erpnext.stock.move_item=function(e,t,a,r,n,s){
	                    var i=new frappe.ui.Dialog({title:a?__("Add Item"):__("Move Item"),
	                    fields:[{fieldname:"item_code",label:__("Item"),fieldtype:"Link",options:"Item",read_only:1},
	                    {fieldname:"source",label:__("Source Warehouse"),fieldtype:"Link",options:"Warehouse",read_only:1},
	                    {fieldname:"target",label:__("Target Warehouse"),fieldtype:"Link",options:"Warehouse",reqd:1},
	                    {fieldname:"qty",label:__("Quantity"),reqd:1,fieldtype:"Float",description:__("Available {0}",[r])},
	                    {fieldname:"rate",label:__("Rate"),fieldtype:"Currency",hidden:1}]});
	                    i.show(),i.get_field("item_code").set_input(e),t?i.get_field("source").set_input(t):(i.get_field("source").df.hidden=1,i.get_field("source").refresh()),
	                    n&&(i.get_field("rate").set_value(n),i.get_field("rate").df.hidden=0,i.get_field("rate").refresh()),
	                    a&&(i.get_field("target").df.read_only=1,i.get_field("target").value=a,
	                    i.get_field("target").refresh()),
	                    i.set_primary_action(__("Submit"),
	                    function(){
	                        var e=i   .get_values();
	                        e&&(t&&e.qty>r?frappe.msgprint(__("Quantity must be less than or equal to {0}",[r])):(e.source===e.target&&frappe.msgprint(__("Source and target warehouse must be different")),
	                        frappe.call({method:"erpnext.stock.doctype.stock_entry.stock_entry_utils.make_stock_entry",args:e,freeze:!0,
	                        callback:function(e){
	                            frappe.show_alert(__("Stock Entry {0} created",['<a href="#Form/Stock Entry/'+e.message.name+'">'+e.message.name+"</a>"])),
	                            i.hide(),s(e)}})))}),$('<p style="margin-left: 10px;"><a class="link-open text-muted small">'+__("Add more items or open full form")+"</a></p>").appendTo(i.body).find(".link-open").on("click",function(){
	                                frappe.model.with_doctype("Stock Entry",function(){
	                                    var e=frappe.model.get_new_doc("Stock Entry");
	                                    e.from_warehouse=i.get_value("source"),
					    e.to_warehouse=i.get_value("target");
	                                    var t=frappe.model.add_child(e,"items");
	                                    t.item_code=i.get_value("item_code"),
	                                    t.f_warehouse=i.get_value("target"),
	                                    t.t_warehouse=i.get_value("target"),
	                                    t.qty=i.get_value("qty"),t.conversion_factor=1,
	                                    t.transfer_qty=i.get_value("qty"),
	                                    t.basic_rate=i.get_value("rate"),
	                                    frappe.set_route("Form",e.doctype,e.name)
	                                })
	                            })
	                }}();

function get_paid_invoices(supplier){	
	selections=""
		 let dialogObj= new frappe.ui.form.MultiSelectDialog({
			 doctype: "Purchase Invoice",
			 target: this,
			 setters: {
			 grand_total:"",
			 due_date:"",
			 paid_date:""
			 },
			 date_field: "transaction_date",
			 get_query() {
			 return {
				 filters: {  docstatus: ['=', 1],supplier: ['=', supplier],status: ['=', 'Paid']}
				 }
			 },
			 action(selections) {
			}
	})
}
//# sourceMappingURL=item-dashboard.min.js.map
